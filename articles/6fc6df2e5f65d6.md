---
title: "Next.js所作"
emoji: "🗒"
type: "tech"
topics: [nextjs, chakraui, storybook, eslint, jest]
published: false
---

書き始めるたびに同じことを調べている気がするのでまとめ。

# 使う技術

- Next.js
- Chakra UI

# Next.js で最初にやること

## アプリを作る

[Create Next App](https://nextjs.org/docs/api-reference/create-next-app)

```sh
npx create-next-app@latest --ts --use-npm
```

## いらないコードを消す

```sh
rm -rf public/ styles/ pages/api/
mkdir src/
mv pages/ src/
```

```ts:src/pages/_app.tsx
import type { AppProps } from "next/app";

function MyApp({ Component, pageProps }: AppProps) {
  return <Component {...pageProps} />;
}

export default MyApp;
```

```ts:src/pages/index.tsx
import type { NextPage } from "next";

const Home: NextPage = () => {
  return <>Home</>;
};

export default Home;
```

# linter と formatter の設定

## prettier を追加

[prettier](https://www.npmjs.com/package/prettier)
[next lint 周り](https://nextjs.org/docs/basic-features/eslint)

```sh
npm i -D prettier eslint-config-prettier
```

```diff json:.eslintrc.json
{
- "extends": "next/core-web-vitals"
+ "extends": [
+   "next/core-web-vitals",
+   "prettier"
+ ]
}
```

```diff json:package.json
{
  "scripts": {
    ...
+   "check-types": "tsc --noEmit",
+   "lint": "next lint --dir src",
+   "lint:fix": "next lint --fix --dir src",
+   "format": "prettier --write --ignore-path .gitignore 'src/**/*.{ts,tsx,json}'"
  }
}
```

## pre-commit の設定

[husky](https://www.npmjs.com/package/husky)
[lint-staged](https://github.com/okonet/lint-staged)

```sh
npm i -D husky lint-staged
npm set-script prepare "husky install"
npm run prepare
npx husky add .husky/pre-commit "npm run lint-staged"
```

```js:.lintstagedrc.js
const path = require("path");

const buildEslintCommand = (filenames) =>
  `next lint --fix --file ${filenames
    .map((f) => path.relative(process.cwd(), f))
    .join(" --file ")}`;

const buildPrettierCommand = (filenames) =>
  `prettier --write ${filenames
    .map((f) => path.relative(process.cwd(), f))
    .join(" ")}`;

const typeCheck = () => `tsc --noEmit`;

module.exports = {
  "*.{ts,tsx}": [buildPrettierCommand],
  "*.{js,jsx,ts,tsx}": [buildEslintCommand, typeCheck],
};
```
